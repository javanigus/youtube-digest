name: yt-digest

on:
  schedule:
    - cron: "0 14 * * *"  # daily at 14:00 UTC (adjust)
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 24

      - name: Install deps
        run: npm ci

      - name: Run digest
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          SCRAPINGDOG_API_KEY: ${{ secrets.SCRAPINGDOG_API_KEY }}
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}

          # caps + config
          CAP_DAILY_PER_SECTION: "20"
          CAP_WEEKLY_PER_SECTION: "50"
          MAX_VIDEOS_PER_CHANNEL: "10"
          # add your other vars here exactly like your .env

        run: node index.mjs
